// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Order {
  id               String   @id
  items            Json     // Array of OrderItem objects
  customerInfo     Json     // CustomerInfo object
  fulfillmentMethod String  // "pickup" or "shipping"
  shippingAddress  Json?    // ShippingAddress object (optional)
  subtotal         Int      // in cents
  shippingCost     Int      // in cents
  tax              Int      // in cents
  total            Int      // in cents
  paymentId        String
  status           String   // OrderStatus enum as string
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  statusHistory    Json     // Array of OrderStatusUpdate objects
  trackingNumber   String?  // tracking number for shipped orders
  adminNotes       String?  // internal notes (not shown to customer)
  auditLog         OrderAuditLog[]

  @@index([status])
  @@index([createdAt])
  @@index([fulfillmentMethod])
  @@index([paymentId])
  @@map("orders")
}

model OrderAuditLog {
  id          String   @id @default(uuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  action      String   // "status_change", "tracking_added", "note_added", "bulk_status_change"
  actor       String   // "admin", "system", "customer"
  fromStatus  String?  // previous status (null for non-status actions)
  toStatus    String?  // new status (null for non-status actions)
  note        String?  // optional note or reason
  metadata    Json?    // extra data (tracking number, bulk operation ID, etc.)
  createdAt   DateTime @default(now())

  @@index([orderId])
  @@index([createdAt])
  @@index([action])
  @@map("order_audit_log")
}
